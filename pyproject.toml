[build-system]
build-backend = "setuptools.build_meta"
requires = [
  "setuptools>=50",
  "setuptools_scm>=6",
  "wheel>=0.34",
]  # ought to mirror 'requirements/build.txt'

[tool.isort]
line_length = 88
wrap_length = 80
sections = ["FUTURE", "STDLIB", "FIRSTPARTY", "LOCALFOLDER"]
known_first_party = ["xrtpy"]
default_section = "STDLIB"
multi_line_output = 3
use_parentheses = true
include_trailing_comma = true
force_alphabetical_sort_within_sections = true
lines_between_types = 1

[tool.codespell]
skip = "*.genx,*.geny,*.png,*egg*,.git,.hypothesis,.nox,.tox,.idea,__pycache__,_build"
ignore-words-list = """
circularly,
nd,
sav,
te
"""

[tool.gilesbot]

[tool.gilesbot.pull_requests]
enabled = true

[tool.ruff]
target-version = "py39"
extend-select = [
  "A", # flake8-builtins
  "ARG", # flake8-unused-arguments
  "B",  # flake8-bugbear
  "BLE", # flake8-blind-except
  "C4", # flake8-comprehensions
  "COM818", # trailing-comma-on-bare-tuple
  "D",  # pydocstyle
  "FBT003", # flake8-boolean-trap
  "ICN", # flake8-import-conventions
  "INP", # flake8-no-pep420
  "INT", # flake8-gettext
  "ISC", # flake8-implicit-str-concat
  "N", # pep8-naming
  "NPY001", # numpy-deprecated-type-alias
  "PD", # pandas-vet
  "PGH", # pygrep-hooks
  "PIE", # flake8-pie
  "PLC", # pylint convention
  "PLE", # pylint errors
  "PT", # flake8-pytest-style
  "PLW", # pylint warnings
  "PTH", # flake8-use-pathlib
  "PYI", # flake8-pyi
  "RUF", # ruff specific rules
  "S", # flake8-bandit
  "SIM", # flake8-simplify
  "TID", # flake8-tidy-imports
  "TRY", # tryceratops
  "UP", # pyupgrade
  "W", # pycodestyle warnings
]
ignore = [
  "B028", # no-explicit-stacklevel
  "D100", # undocumented-public-module
  "D101", # undocumented-public-class
  "D102", # undocumented-public-method
  "D103", # undocumented-public-function
  "D104", # undocumented-public-package
  "D105", # undocumented-public-method
  "D200", # fits-on-one-line
  "D202", # no-blank-line-after-function
  "D203", # one-blank-line-before-class
  "D205", # blank-line-after-summary
  "D209", # new-line-after-last-paragraph
  "D212", # multi-line-summary-first-line
  "D301", # escape-sequence-in-docstring (should be enabled)
  "D400", # ends-in-period
  "D401", # non-imperative-mood (should be enabled)
  "D404", # docstring-starts-with-this (should be enabled)
  "D410", # no-blank-line-after-section
  "D415", # ends-in-punctuation
  "E501", # line-too-long
  "N801", # invalid-class-name
  "N802", # invalid-function-name
  "N803", # invalid-argument-name
  "N806", # non-lowercase-variable-in-function
  "N816", # mixed-case-variable-in-global-scope
  "PLE0605", # invalid-all-format
  "PT007", # pytest-parametrize-values-wrong-type
  "PT011", # pytest-raises-too-broad
  "PT012", # pytest-raises-multiple-statements
  "PT019", # pytest-fixture-param-without-value (enable later?)
  "RUF001", # ambiguous-unicode-character-string
  "RUF002", # ambiguous-unicode-character-docstring
  "RUF003", # ambiguous-unicode-character-comment
  "RUF100", # unused-noqa (remove if we drop flake8 completely)
  "S101", # asserts
  "SIM117", # multiple-with-statements (remove for Python 3.10+)
  "SIM300", # yoda-conditions
  "TRY003", # raise-vanilla-args
  "TRY301", # raise-within-try
  "UP025", # unicode-kind-prefix
]
extend-exclude = [
    ".jupyter",
    "__pycache__",
    "_build",
    "_dev",
]
namespace-packages = [".github/workflows", "docs"]
show-fixes = true
show-source = true

[tool.ruff.flake8-import-conventions.aliases]
"astropy.units" = "u"
"matplotlib.pyplot" = "plt"
numpy = "np"
pandas = "pd"

[tool.ruff.flake8-unused-arguments]
ignore-variadic-names = true

[tool.ruff.mccabe]
max-complexity = 20

[tool.ruff.per-file-ignores]
"__init__.py" = ["E402", "F401", "F402", "F403"]  # ignore import errors

[tool.ruff.pydocstyle]
convention = "numpy"

[tool.ruff.pyupgrade]
keep-runtime-typing = true  # remove when we drop support for Python 3.9

[tool.towncrier]
package = "xrtpy"
name = "XRTpy"
filename = "CHANGELOG.rst"
directory = "changelog/"
title_format = "{name} v{version} ({project_date})"
issue_format = ":pr:`{issue}`"  # Despite the name mismatch, we use this for linking to PRs
wrap = true

[[tool.towncrier.type]]
directory = "breaking"
name = "Backwards Incompatible Changes"
showcontent = true

[[tool.towncrier.type]]
directory = "removal"
name = "Deprecations and Removals"
showcontent = true

[[tool.towncrier.type]]
directory = "feature"
name = "Features"
showcontent = true

[[tool.towncrier.type]]
directory = "bugfix"
name = "Bug Fixes"
showcontent = true

[[tool.towncrier.type]]
directory = "doc"
name = "Improved Documentation"
showcontent = true

[[tool.towncrier.type]]
directory = "trivial"
name = "Trivial/Internal Changes"
showcontent = true
